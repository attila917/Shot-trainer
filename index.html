<!doctype html>
<html lang="hu">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pl√°n Felismer≈ë ¬∑ Film Stills m√≥d</title>
    <meta name="description" content="Vanilla JS, HU/EN, cutline-accurate mockups + optional film stills gallery per category." />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      :root { --bg:#f8fafc; --fg:#0f172a; --muted:#64748b; --card:#ffffff; --border:#e2e8f0; --accent:#111827; --ok:#16a34a; --bad:#dc2626; }
      *{box-sizing:border-box} html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
      .wrap{max-width:1100px;margin:0 auto;padding:16px}
      header{position:sticky;top:0;background:rgba(255,255,255,.85);backdrop-filter:blur(6px);border-bottom:1px solid var(--border);z-index:5}
      .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
      .title{display:flex;align-items:center;gap:10px}
      .logo{width:36px;height:36px;border-radius:12px;background:#000;color:#fff;display:grid;place-items:center;font-weight:700}
      .sub{font-size:12px;color:var(--muted)}
      .btn{padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:pointer;font-size:14px}
      .btn.primary{background:#000;color:#fff;border-color:#000}
      .chips{display:flex;gap:8px;flex-wrap:wrap}
      .chip{padding:6px 10px;border:1px solid var(--border);border-radius:999px;font-size:13px;color:#334155;background:#fff}
      .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.04)}
      .grid{display:grid;gap:12px}
      @media(min-width:900px){ .grid.cols-3{grid-template-columns:repeat(3,1fr)} }
      .question{font-weight:600}
      .viewer{border:1px solid var(--border);border-radius:14px;overflow:hidden;background:#0a0a0a;color:#f8fafc;display:grid;place-items:center}
      .frame{width:100%;aspect-ratio:16/9;position:relative;background:#111}
      .frame img, .frame svg{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
      .opts{display:grid;gap:8px;margin-top:12px}
      @media(min-width:900px){ .opts{grid-template-columns:repeat(4,1fr)} }
      .opt{padding:12px;border:1px solid var(--border);border-radius:12px;background:#fff;text-align:left;font-size:14px;cursor:pointer}
      .opt.ok{background:#16a34a;color:white;border-color:#15803d}
      .opt.dim{opacity:.6}
      .note{margin-top:8px;font-size:14px}
      .note.ok{color:#166534}.note.bad{color:#b91c1c}
      footer{color:#94a3b8;text-align:center;font-size:12px;padding:40px 0}
      select, input[type=file]{font-size:14px}
      .ref-item{border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:10px}
      .muted{color:#94a3b8;font-size:12px}
      .hidden{display:none}
      .toggle{display:inline-flex;align-items:center;gap:8px}
      .source{position:absolute;left:10px;bottom:8px;background:rgba(0,0,0,.55);color:#eee;padding:4px 8px;border-radius:8px;font-size:12px}
      .pill{padding:4px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;background:#fff}
      .pill.on{background:#000;color:#fff;border-color:#000}
    </style>
  </head>
  <body>
    <header>
      <div class="wrap row" style="justify-content:space-between;padding:10px 16px">
        <div class="title">
          <div class="logo">PF</div>
          <div>
            <div id="appName" style="font-weight:600">Pl√°n Felismer≈ë ‚Äî Film Stills m√≥d</div>
            <div class="sub" id="subtitle">Sziluett + v√°g√°sjel√∂l≈ëk, vagy film stills p√©ld√°k (HU/EN)</div>
          </div>
        </div>
        <div class="row">
          <label class="sub" id="langLabel" for="langSel">Nyelv:</label>
          <select id="langSel" class="btn">
            <option value="hu">Magyar</option>
            <option value="en">English</option>
          </select>
          <button id="modePractice" class="btn">Gyakorl√°s</button>
          <button id="modeQuiz" class="btn">Gyorsteszt (10)</button>
          <button id="exportBtn" class="btn">Export</button>
          <label class="btn" style="cursor:pointer">Import
            <input id="importInput" type="file" accept="application/json" class="hidden">
          </label>
        </div>
      </div>
    </header>

    <main class="wrap grid" style="padding:16px 16px 32px 16px">
      <section class="grid cols-3">
        <div class="card">
          <div class="sub" id="scoreLabel">Pontsz√°m</div>
          <div style="font-size:24px;font-weight:600"><span id="score">0</span><span id="scoreMax" class="muted"></span></div>
        </div>
        <div class="card">
          <div class="sub" id="streakLabel">Sorozat</div>
          <div style="font-size:24px;font-weight:600" id="streak">0</div>
        </div>
        <div class="card">
          <div class="sub" id="modeLabel">M√≥d</div>
          <div class="chips" style="margin-top:6px">
            <span class="chip" id="chipPractice">Gyakorl√°s</span>
            <span class="chip" id="chipQuiz">Gyorsteszt (10)</span>
            <span class="chip" id="chipCats">0 kateg√≥ria</span>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="row" style="justify-content:space-between;margin-bottom:8px">
          <div class="question" id="qTitle">Milyen pl√°n l√°that√≥?</div>
          <div class="row" style="gap:8px">
            <span class="pill on" id="silhouettePill">Sziluett</span>
            <span class="pill" id="filmPill">üìΩ Film stills</span>
            <div class="muted" id="leftWrap">H√°tral√©v≈ë: <b id="left">10</b></div>
          </div>
        </div>
        <div class="viewer">
          <div class="frame" id="frame">
            <div class="source" id="source"></div>
          </div>
        </div>
        <div class="opts" id="opts"></div>
        <div class="note" id="feedback"></div>
        <div class="row" style="margin-top:10px">
          <button id="nextBtn" class="btn">K√∂vetkez≈ë</button>
          <button id="restartBtn" class="btn">√öjrakezd√©s</button>
          <button id="samplesBtn" class="btn">Mintak√©szlet: bekapcsolva</button>
        </div>
      </section>

      <section class="card">
        <div class="row" style="justify-content:space-between">
          <div class="question" id="teacherTitle">Tan√°ri be√°ll√≠t√°sok</div>
        </div>
        <div class="grid" style="grid-template-columns:1fr 1fr;gap:16px;margin-top:12px">
          <div>
            <div class="sub" id="catsLabel">Kateg√≥ri√°k</div>
            <div id="catList" class="row" style="gap:8px;margin:8px 0;flex-wrap:wrap"></div>
            <button id="addCatBtn" class="btn">+ √öj kateg√≥ria</button>
          </div>
          <div>
            <div class="sub" id="uploadTitle">Saj√°t k√©pek felt√∂lt√©se</div>
            <label class="row" style="border:2px dashed var(--border);border-radius:16px;padding:18px;cursor:pointer">
              <div>
                <div id="uploadHint1">H√∫zd ide a k√©peket vagy kattints a felt√∂lt√©shez</div>
                <div class="muted" id="uploadHint2">A rendszer megk√©rdezi, melyik kateg√≥ri√°hoz rendelj√ºk</div>
              </div>
              <input id="uploadInput" type="file" accept="image/*" multiple class="hidden">
            </label>
            <div class="muted" id="localNote" style="margin-top:8px">A k√©pek √©s be√°ll√≠t√°sok csak ezen a b√∂ng√©sz≈ën t√°rol√≥dnak (localStorage).</div>
          </div>
        </div>
      </section>
    </main>

    <footer>Forr√°s: saj√°t jegyzet + helyi minta√°llom√°nyok ‚Ä¢ DV Studio √ó ChatGPT</footer>

    <script>
      // ======= Canon + labels =======
      const CANON = [
        { hu: "Szuper pl√°n", en: "Extreme Close-Up (XCU)" },
        { hu: "Nagyk√∂zeli / Premier pl√°n", en: "Big Close-Up (BCU)" },
        { hu: "Sz≈±k szekond (mell felett)", en: "Tight Medium Close-Up" },
        { hu: "Szekond (k√∂ld√∂k felett)", en: "Medium Close-Up (MCU)" },
        { hu: "Amerikai (combk√∂z√©p)", en: "American Shot (3/4)" },
        { hu: "Olasz (l√°bsz√°rk√∂z√©p)", en: "Italian Shot" },
        { hu: "Kistot√°l (teljes alak)", en: "Full Shot (FS)" },
        { hu: "Tot√°l pl√°n", en: "Wide Shot (WS)" },
        { hu: "Nagy tot√°l", en: "Extreme Wide Shot (EWS)" }
      ];

      const STR = {
        hu: { appName:"Pl√°n Felismer≈ë ‚Äî Film m√≥d", subtitle:"Sziluett + filmk√©p p√©ld√°k", practice:"Gyakorl√°s", quiz10:"Gyorsteszt (10)", export:"Export", import:"Import",
              score:"Pontsz√°m", streak:"Sorozat", mode:"M√≥d", cats:n=>n+" kateg√≥ria", questionTitle:"Milyen pl√°n l√°that√≥?",
              remaining:"H√°tral√©v≈ë:", next:"K√∂vetkez≈ë", restart:"√öjrakezd√©s", teacherTools:"Tan√°ri be√°ll√≠t√°sok", categories:"Kateg√≥ri√°k",
              newCat:"+ √öj kateg√≥ria", uploadTitle:"Saj√°t k√©pek felt√∂lt√©se", uploadHint1:"H√∫zd ide a k√©peket vagy kattints", uploadHint2:"V√°laszd ki a kateg√≥ri√°t",
              localNote:"A k√©pek helyben t√°rol√≥dnak.", correct:"Helyes!", wrong:s=>"Nem pontos. Helyes: "+s, sampleSet:"Mintak√©szlet", sampleOn:"bekapcsolva", sampleOff:"kikapcsolva" },
        en: { appName:"Shot Size Trainer ‚Äî Film mode", subtitle:"Silhouette + film stills examples", practice:"Practice", quiz10:"Quick Test (10)", export:"Export", import:"Import",
              score:"Score", streak:"Streak", mode:"Mode", cats:n=>n+" categories", questionTitle:"Which shot size is shown?",
              remaining:"Remaining:", next:"Next", restart:"Restart", teacherTools:"Teacher tools", categories:"Categories",
              newCat:"+ New category", uploadTitle:"Upload your own images", uploadHint1:"Drag & drop or click", uploadHint2:"Choose category",
              localNote:"Images are stored locally.", correct:"Correct!", wrong:s=>"Not quite. Correct: "+s, sampleSet:"Sample set", sampleOn:"ON", sampleOff:"OFF" }
      };

      const LS = { bank:"plan-film:bank:v1", mode:"plan-film:mode:v1", lang:"plan-film:lang:v1", sample:"plan-film:sample:v1", film:"plan-film:film:v1" };

      const $ = s=>document.querySelector(s);
      const el = (t,p={},...c)=>{ const n=document.createElement(t); Object.entries(p).forEach(([k,v])=>{
        if(k==='class') n.className=v; else if(k==='html') n.innerHTML=v; else if(k.startsWith('on')) n.addEventListener(k.slice(2).toLowerCase(), v); else n.setAttribute(k,v);
      }); c.forEach(x=>n.append(x)); return n; };

      // Minimal silhouette SVG (kept from previous accurate crop version)
      function silhouetteSVG(){
        const W=1280,H=720, cx=W/2;
        const ground=H-40, torsoH=260*0.5, legH=260*0.37, headR=260*0.08, shoulderW=260*0.18;
        const torsoTop = ground - legH - torsoH;
        return \`
          <svg viewBox="0 0 \${W} \${H}">
            <defs>
              <linearGradient id="bg" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#0b0b0b"/><stop offset="100%" stop-color="#1b1b1b"/>
              </linearGradient>
            </defs>
            <rect width="\${W}" height="\${H}" fill="url(#bg)"/>
            <rect x="0" y="\${ground}" width="\${W}" height="40" fill="#111"/>
            <line x1="\${cx-10}" y1="\${ground}" x2="\${cx-18}" y2="\${ground-legH}" stroke="#bfbfbf" stroke-width="12" stroke-linecap="round"/>
            <line x1="\${cx+10}" y1="\${ground}" x2="\${cx+18}" y2="\${ground-legH}" stroke="#bfbfbf" stroke-width="12" stroke-linecap="round"/>
            <line x1="\${cx}" y1="\${ground-legH}" x2="\${cx}" y2="\${torsoTop}" stroke="#e6e6e6" stroke-width="16" stroke-linecap="round"/>
            <line x1="\${cx}" y1="\${torsoTop+torsoH*0.15}" x2="\${cx-shoulderW}" y2="\${torsoTop+torsoH*0.3}" stroke="#d0d0d0" stroke-width="14" stroke-linecap="round"/>
            <line x1="\${cx}" y1="\${torsoTop+torsoH*0.15}" x2="\${cx+shoulderW}" y2="\${torsoTop+torsoH*0.3}" stroke="#d0d0d0" stroke-width="14" stroke-linecap="round"/>
            <circle cx="\${cx}" cy="\${torsoTop-headR}" r="\${headR}" fill="#c9c9d1" stroke="#efefef" stroke-width="6"/>
          </svg>\`;
      }

      // Film stills loader
      let FILM = {}; // label -> [{src, credit}]
      async function loadFilmStills(){
        try{
          const r = await fetch('filmstills.json', {cache:'no-store'});
          if(r.ok){ FILM = await r.json(); } else { FILM = {}; }
        }catch(e){ FILM = {}; }
      }

      // App state
      let state = {
        lang: localStorage.getItem(LS.lang) || 'hu',
        mode: localStorage.getItem(LS.mode) || 'practice',
        useSamples: localStorage.getItem(LS.sample)==='0' ? false : true,
        filmMode: localStorage.getItem(LS.film)==='1',
        bank: null,
        current: null,
        options: [],
        score: 0, streak: 0, left: 10, locked:false
      };

      function labels(){ return (state.lang==='hu' ? CANON.map(x=>x.hu) : CANON.map(x=>x.en)); }
      function mapToBoth(label){
        const i = (state.lang==='hu' ? CANON.findIndex(x=>x.hu===label) : CANON.findIndex(x=>x.en===label));
        const hu = CANON[i]?.hu, en = CANON[i]?.en;
        return {hu,en};
      }

      function initBank(){
        const saved = localStorage.getItem(LS.bank);
        if(saved){ state.bank = JSON.parse(saved); return; }
        const labs = labels();
        state.bank = labs.flatMap(l => [
          { id: uid(), label:l, source:{type:'svg'} },
          { id: uid(), label:l, source:{type:'svg'} },
        ]);
      }

      const uid = ()=> Math.random().toString(36).slice(2,10);
      function save(){ localStorage.setItem(LS.lang,state.lang); localStorage.setItem(LS.mode,state.mode); localStorage.setItem(LS.sample,state.useSamples?'1':'0'); localStorage.setItem(LS.film, state.filmMode?'1':'0'); localStorage.setItem(LS.bank, JSON.stringify(state.bank)); }

      // UI els
      const scoreEl=$("#score"), scoreMax=$("#scoreMax"), streakEl=$("#streak"), leftWrap=$("#leftWrap"), leftEl=$("#left");
      const chipPractice=$("#chipPractice"), chipQuiz=$("#chipQuiz"), chipCats=$("#chipCats");
      const frame=$("#frame"), sourceEl=$("#source");
      const opts=$("#opts"), feedback=$("#feedback");
      const nextBtn=$("#nextBtn"), restartBtn=$("#restartBtn"), samplesBtn=$("#samplesBtn");
      const silhouettePill=$("#silhouettePill"), filmPill=$("#filmPill");
      const langSel=$("#langSel");

      function applyStrings(){
        const T=STR[state.lang];
        $("#appName").textContent=T.appName; $("#subtitle").textContent=T.subtitle;
        $("#modePractice").textContent=T.practice; $("#modeQuiz").textContent=T.quiz10; $("#exportBtn").textContent=T.export;
        $("#scoreLabel").textContent=T.score; $("#streakLabel").textContent=T.streak; $("#modeLabel").textContent=T.mode;
        $("#qTitle").textContent=T.questionTitle; leftWrap.childNodes[0].nodeValue=T.remaining+" ";
        nextBtn.textContent=T.next; restartBtn.textContent=T.restart;
        $("#teacherTitle").textContent=T.teacherTools; $("#catsLabel").textContent=T.categories; $("#addCatBtn").textContent=T.newCat;
        $("#uploadTitle").textContent=T.uploadTitle; $("#uploadHint1").textContent=T.uploadHint1; $("#uploadHint2").textContent=T.uploadHint2; $("#localNote").textContent=T.localNote;
        samplesBtn.textContent=T.sampleSet+": "+(state.useSamples?T.sampleOn:T.sampleOff);
      }

      function pickNew(reset=false){
        const labs = labels();
        const pool = state.useSamples ? [
          ...state.bank,
          ...labs.map(l=>({id:'S-'+l, label:l, source:{type:'sample'}}))
        ] : state.bank;
        const item = pool[Math.floor(Math.random()*pool.length)];
        state.current = item;
        const other = labs.filter(x=>x!==item.label);
        const rand = shuffle(other).slice(0, Math.min(3, labs.length-1));
        state.options = shuffle([item.label, ...rand]);
        state.locked=false; feedback.textContent=''; feedback.className='note';
        if(reset){ state.score=0; state.streak=0; state.left=10; }
        draw();
      }

      function draw(){
        const labs = labels();
        const T=STR[state.lang];
        chipPractice.classList.toggle('primary', state.mode==='practice'); chipQuiz.classList.toggle('primary', state.mode==='quiz10');
        chipCats.textContent = T.cats(labs.length);
        leftWrap.style.display = (state.mode==='quiz10')? 'block':'none';
        scoreEl.textContent=state.score; scoreMax.textContent = state.mode==='quiz10' ? " /10" : "";
        streakEl.textContent=state.streak; leftEl.textContent=state.left;
        samplesBtn.textContent = T.sampleSet + ": " + (state.useSamples? T.sampleOn : T.sampleOff);
        silhouettePill.classList.toggle('on', !state.filmMode);
        filmPill.classList.toggle('on', state.filmMode);

        // viewer
        frame.innerHTML='';
        sourceEl.textContent='';
        const label = state.current?.label || labs[0];
        if(state.filmMode){
          const {hu,en} = mapToBoth(label);
          const keyCandidates = [hu,en].filter(Boolean);
          let src = null, credit="";
          for(const k of keyCandidates){
            const arr = FILM[k];
            if(arr && arr.length){ const pick = arr[Math.floor(Math.random()*arr.length)]; src=pick.src; credit=pick.credit||""; break; }
          }
          if(src){
            const img = new Image(); img.src = src; img.alt = 'film still'; img.loading='eager';
            img.onerror = ()=>{ frame.innerHTML = silhouetteSVG(); sourceEl.textContent = (state.lang==='hu'?'Forr√°s:':'Source:')+' helyi sziluett (fallback)'; };
            frame.appendChild(img); sourceEl.textContent = credit ? ((state.lang==='hu'?'Forr√°s: ':'Source: ')+credit) : '';
          }else{
            frame.innerHTML = silhouetteSVG();
            sourceEl.textContent = (state.lang==='hu'?'Forr√°s:':'Source:')+' helyi sziluett (nincs filmk√©p ehhez a kateg√≥ri√°hoz)';
          }
        }else{
          frame.innerHTML = silhouetteSVG();
        }

        // options
        opts.innerHTML='';
        state.options.forEach(opt=>{
          const b = el('button',{class:'opt', onClick: ()=>answer(opt)}, opt);
          opts.appendChild(b);
        });
      }

      function answer(choice){
        if(state.locked) return;
        const T = STR[state.lang];
        const correct = (choice===state.current.label);
        Array.from(opts.children).forEach(ch=>{
          const b=ch; if(b.textContent===state.current.label) b.classList.add('ok');
          else if(correct===false) b.classList.add('dim');
        });
        state.locked=true;
        feedback.textContent = correct ? T.correct : T.wrong(state.current.label);
        feedback.className = 'note ' + (correct? 'ok':'bad');
        if(correct){ state.score++; state.streak++; } else { state.streak=0; }
        if(state.mode==='quiz10'){ state.left--; }
        setTimeout(()=>{
          if(state.mode==='quiz10' && state.left<=0){
            alert( (state.lang==='hu'? 'Teszt v√©ge! Pontsz√°m: ' : 'Test finished! Score: ') + state.score + (state.lang==='hu' ? "/10" : "/10") );
            pickNew(true);
          } else {
            pickNew(false);
          }
        }, 900);
      }

      // helpers
      function shuffle(a){ const arr=a.slice(); for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

      // events
      $("#modePractice").addEventListener('click', ()=>{ state.mode='practice'; save(); draw(); });
      $("#modeQuiz").addEventListener('click', ()=>{ state.mode='quiz10'; save(); state.left=10; draw(); });
      $("#nextBtn").addEventListener('click', ()=> pickNew(false));
      $("#restartBtn").addEventListener('click', ()=> pickNew(true));
      $("#samplesBtn").addEventListener('click', ()=>{ state.useSamples=!state.useSamples; save(); draw(); });
      $("#silhouettePill").addEventListener('click', ()=>{ state.filmMode=false; save(); draw(); });
      $("#filmPill").addEventListener('click', ()=>{ state.filmMode=true; save(); draw(); });
      langSel.addEventListener('change', ()=>{ state.lang=langSel.value; save(); applyStrings(); pickNew(true); });

      // bank/export/import
      const exportBtn=$("#exportBtn"), importInput=$("#importInput");
      exportBtn.addEventListener('click', ()=>{
        const blob = new Blob([JSON.stringify({ bank:state.bank }, null, 2)], {type:'application/json'});
        const url = URL.createObjectURL(blob); const a=document.createElement('a');
        a.href=url; a.download='shot_trainer_dataset.json'; a.click(); URL.revokeObjectURL(url);
      });
      importInput.addEventListener('change', (ev)=>{
        const f = ev.target.files[0]; if(!f) return;
        const r = new FileReader(); r.onload=()=>{
          try{ const data = JSON.parse(r.result); if(!data.bank) throw new Error('bad'); state.bank=data.bank; save(); alert(state.lang==='hu'?'Import sikeres!':'Import successful!'); }
          catch(e){ alert(state.lang==='hu'?'Nem siker√ºlt beolvasni a JSON-t.':'Could not parse JSON.'); }
        }; r.readAsText(f);
      });

      async function boot(){
        await loadFilmStills();
        initBank();
        applyStrings();
        pickNew(true);
      }
      boot();
    </script>
  </body>
</html>
